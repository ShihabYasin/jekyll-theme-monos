---
layout: post
title: Python-simplejson
date: 2019-02-23 16:20:23 +0900
category: Python
tag: Python
---

<html lang="en">
<title>Python simplejson  - read, write JSON in Python with simplejson</title>
<head>


</head>

<body>

<header>

</header>

<div class="container">


<div class="content">

<h1>Python simplejson</h1>

<p>
Read and write JSON data with Python simplejson module.
</p>


<h2>JSON</h2>

<p>
JSON (JavaScript Object Notation) is a lightweight data-interchange format. It is easily 
read and written by humans and parsed and generated by machines. The <code>application/json</code> 
is the official Internet media type for JSON. The JSON filename extension is <code>.json</code>.
</p>

<h2>The simplejson module</h2>

<p>
The <dfn>simplejson</dfn> is simple, fast, complete, and extensible JSON  encoder and decoder for 
Python 2.5+ and Python 3.3+. It is pure Python code with no dependencies.
</p>


<p>
The <code>simplejson</code> module is included in modern Python versions. 
The decoder can handle incoming JSON strings of any specified encoding (UTF-8 by default)
</p>

<h2>Using simplejson</h2>

<pre class="compact">
import json
</pre>

<p>
To use <code>simplejson</code> module, we import <code>json</code>.
</p>


<h2>Simplejson conversion table</h2>

<p>
The following table shows how data types are converted
between Python and JSON.
</p>

<table>
<thead>
<tr><th>Python</th><th>JSON</th></tr>
</thead>

<tbody>
<tr><td>dict, namedtuple</td><td>object</td></tr>
<tr><td>list, tuple</td><td>array</td></tr>
<tr><td>str, unicode</td><td>string</td></tr>
<tr><td>int, long, float</td><td>number</td></tr>
<tr><td>True</td><td>true</td></tr>
<tr><td>False</td><td>false</td></tr>
<tr><td>None</td><td>null</td></tr>
</tbody>

</table>


<h2>The json.dump()</h2>

<p>
The <code>json.dump</code> method serializes Python object as a JSON formatted 
stream to a file object.
</p>

<div class="codehead">simplejson_dump.py</div>
<pre class="code">
#!/usr/bin/python

import json

data = {"name": "Jane", "age": 17}

with open('friends.json', 'w') as f:
    
    json.dump(data, f)
</pre>

<p>
The example serializes a Python dictionary into JSON with <code>json.dump</code>
method. The JSON data is written to <code>friends.json</code> file.
</p>

<pre class="compact">
$ cat friends.json 
{"age": 17, "name": "Jane"}
</pre>

<p>
After executing the script, we have this data.
</p>


<h2>The json.dumps()</h2>

<p>
The <code>json.dumps</code> method serializes Python object to a JSON string.
</p>

<div class="codehead">simplejson_dumps.py</div>
<pre class="code">
#!/usr/bin/python

import json

data = [{"name": "Jane", "age": 17}, {"name": "Thomas", "age": 27}]

json_data = json.dumps(data)
print(repr(json_data))
</pre>

<p>
The example serializes a Python list into JSON string with <code>json.dumps</code>
method. The JSON data is printed to the console.
</p>

<pre class="compact">
$ ./simplejson_dumps.py 
'[{"name": "Jane", "age": 17}, {"name": "Thomas", "age": 27}]'
</pre>

<p>
This is the output of the example.
</p>


<h2>The json.load()</h2>

<p>
The <code>json.load</code> method deserializes a file object containing 
a JSON document to a Python object.
</p>

<div class="codehead">config.json</div>
<pre class="code">
{
  "theme" : "bluespring",
  "size": "small",
  "splashscreen": "false"
}
</pre>

<p>
The <code>config.json</code> file contains this data.
</p>

<div class="codehead">read_config.py</div>
<pre class="code">
#!/usr/bin/python

import json

with open('config.json') as f:

    config = json.load(f)
    
    print('Theme: {}'.format(config['theme']))
    print('Size: {}'.format(config['size']))
    print('Splash screen: {}'.format(config['splashscreen']))
</pre>

<p>
The example reads configuration data from <code>config.json</code> file
with <code>json.load</code> and prints the data to the terminal.
</p>

<pre class="compact">
$ ./read_config.py 
Theme: bluespring
Size: small
Splash screen: false
</pre>






<h2>The json.loads()</h2>

<p>
The <code>json.loads</code> method deserializes a JSON string to a Python object.
</p>

<div class="codehead">simplejson_loads.py</div>
<pre class="code">
#!/usr/bin/python

import json

json_data = '{"name": "Jane", "age": 17}'

data = json.loads(json_data)

print(type(json_data))
print(type(data))

print(data)
</pre>

<p>
The example deserializes a JSON string into a Python dictionary.
</p>

<pre class="compact">
$ ./simple.py 
&lt;class 'str'&gt;
&lt;class 'dict'&gt;
{'name': 'Jane', 'age': 17}
</pre>

<p>
This is the output of the example.
</p>


<h2>Simplejson read JSON from URL</h2>

<p>
The following example reads JSON data from a web page. We get JSON data 
from <code>http://time.jsontest.com</code>.
</p>

<pre class="compact">
$ curl http://time.jsontest.com
{
   "time": "10:00:19 AM",
   "milliseconds_since_epoch": 1496311219347,
   "date": "06-01-2017"
}
</pre>

<p>
A GET request to this site returns this JSON string.
</p>

<div class="codehead">parse_json_url.py</div>
<pre class="code">
#!/usr/bin/python

import json
import urllib.request

hres = urllib.request.urlopen('http://time.jsontest.com')

data = json.loads(hres.read().decode("utf-8"))

print('Unix time: {}'.format(data['milliseconds_since_epoch']))
print('Time: {}'.format(data['time']))
print('Date: {}'.format(data['date']))
</pre>

<p>
In the example, we use <code>urllib.request</code> module to 
create a request to the web site. 
</p>

<pre class="explanation">
data = json.loads(hres.read().decode("utf-8"))
</pre>

<p>
From the returned response, we transform the JSON string into a Python
dictionary with <code>json.loads</code> method.
</p>

<pre class="explanation">
print('Unix time: {}'.format(data['milliseconds_since_epoch']))
print('Time: {}'.format(data['time']))
print('Date: {}'.format(data['date']))
</pre>

<p>
With the help of Python's <code>format</code> method, we print the retrieved data
to the console.
</p>

<pre class="compact">
$ ./parse_json_url.py 
Unix time: 1496311518866
Time: 10:05:18 AM
Date: 06-01-2017
</pre>



<h2>Pretty printing</h2>

<p>
With simplejson we can easily pretty print our data.
</p>

<div class="codehead">pretty_print_json.py</div>
<pre class="code">
#!/usr/bin/python

import json

json_data = {"name":"Audi", "model":"2012", "price":22000, 
                 "colours":["gray", "red", "white"]}

data = json.dumps(json_data, sort_keys=True, indent=4 * ' ')

print(data)
</pre>

<p>
With <code>sort_keys</code> and <code>indent</code> options we nicely format the JSON data.
</p>

<pre class="compact">
$ ./pretty_print_json.py 
{
    "colours": [
        "gray",
        "red",
        "white"
    ],
    "model": "2012",
    "name": "Audi",
    "price": 22000
}
</pre>

<p>
This is the output of the example. The data is indented and the keys are sorted.
</p>


<h2>Simplejson custom class</h2>

<p>
Simplejson serializes and deserializes only a few Python objects, which are listed
in the conversion table. For custom Python objects, we need to do some additional 
steps.
</p>

<div class="codehead">custom_class.py</div>
<pre class="code">
#!/usr/bin/python

import json

class Person(object):
    
    def __init__(self, name, age):
    
        self.name = name
        self.age = age
        
p = Person("Lucy", 23) 

json_data = json.dumps(p.__dict__)

print(repr(json_data))
</pre>

<p>
In this example, we serialize a custom object into JSON.
</p>

<pre class="explanation">
json_data = json.dumps(p.__dict__)
</pre>

<p>
The trick is to use the <code>__dict__</code> attribute, which stores
the object attributes (name and age).
</p>

<pre class="compact">
$ ./custom_class.py 
'{"name": "Lucy", "age": 23}'
</pre>



<h2>Simplejson list of custom classes</h2>

<p>
In the next example, we show how to serialize 
a list of custom classes.
</p>

<div class="codehead">custom_class_list.py</div>
<pre class="code">
#!/usr/bin/python

import json

class Person(object):
    
    def __init__(self, name, age):
    
        self.name = name
        self.age = age
        
    def toJson(self):
        '''
        Serialize the object custom object
        '''
        return json.dumps(self, default=lambda o: o.__dict__, 
                sort_keys=True, indent=4)            

p1 = Person("Lucy", 23) 
p2 = Person("Thomas", 29)

people = []
people.append(json.loads(p1.toJson()))
people.append(json.loads(p2.toJson()))

json_data = json.dumps(people)

print(repr(json_data))
</pre>

<p>
We have created a <code>toJson</code> method that serializes the object.
</p>

<pre class="explanation">
people = []
people.append(json.loads(p1.toJson()))
people.append(json.loads(p2.toJson()))
</pre>

<p>
We call the <code>toJson</code> method when we add the objects
to the list.
</p>

<pre class="compact">
$ ./custom_class_list.py 
'[{"age": 23, "name": "Lucy"}, {"age": 29, "name": "Thomas"}]'
</pre>

<p>
This is the output of the example.
</p>


</div> <!-- content -->
</div>

</body>
</html>
